<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:py="http://genshi.edgewall.org/"
    xmlns:xi="http://www.w3.org/2001/XInclude">

<xi:include href="master.html" />
<xi:include href="schedule_downtime.html" />

<head>
	<meta content="text/html; charset=UTF-8" http-equiv="content-type" py:replace="''"/>
	<title>Schedule downtime</title>
    <link type="text/css" rel="stylesheet" href="${tg.url('/css/Autocompleter/Autocompleter.css')}" />
    <link type="text/css" rel="stylesheet" href="${tg.url('/css/downtime.css')}" />
    <link rel="stylesheet" type="text/css" href="${tg.url('/css/jxlib/jxtheme.uncompressed.css')}" />
    <script type="text/javascript" src="${tg.url('/js/mootools.js')}"></script>
    <script type="text/javascript" src="${tg.url('/js/mootools-more.js')}"></script>
    <script type="text/javascript" src="${tg.url('/js/Autocompleter/Autocompleter.js')}"></script>
    <script type="text/javascript" src="${tg.url('/js/Autocompleter/Autocompleter.Request.js')}"></script>
    <script type="text/javascript" src="${tg.url('/js/Autocompleter/Observer.js')}"></script>
    <script type="text/javascript" src="${tg.url('/js/Autocompleter/vigilo.js')}"></script>
</head>

<body>

  	${schedule_downtime()}

	<div id="scheduled_downtimes">
		<h2><span>${l_('Scheduled downtimes')}</span></h2>
		<table id="scheduled_downtimes_table">
			<thead> 
				<tr>
					<th class="action_col"></th>
					
				
				    <py:choose test="">
						<py:when test="sort=='hostname' and order=='asc'">
				    		<th class="asc"><a href="?page=${page}&amp;sort=hostname&amp;order=desc">
				    			<img src="${tg.url('/images/down.gif')}" alt="descending" /> ${l_('Host')}
				    		</a></th>
					  	</py:when>
						<py:when test="sort=='hostname' and order=='desc'">
				    		<th class="desc"><a href="?page=${page}&amp;sort=hostname&amp;order=asc">
				    			<img src="${tg.url('/images/up.gif')}" alt="ascending" /> ${l_('Host')}
				    		</a></th>
					  	</py:when>
						<py:otherwise>
				    		<th><a href="?page=${page}&amp;sort=hostname&amp;order=asc">${l_('Host')}</a></th>
						</py:otherwise>
					</py:choose>
					
					
				    <py:choose test="">
						<py:when test="sort=='servicename' and order=='asc'">
				    		<th class="asc"><a href="?page=${page}&amp;sort=servicename&amp;order=desc">
				    			<img src="${tg.url('/images/down.gif')}" alt="descending" /> ${l_('Service')}
				    		</a></th>
					  	</py:when>
						<py:when test="sort=='servicename' and order=='desc'">
				    		<th class="desc"><a href="?page=${page}&amp;sort=servicename&amp;order=asc">
				    			<img src="${tg.url('/images/up.gif')}" alt="ascending" /> ${l_('Service')}
				    		</a></th>
					  	</py:when>
						<py:otherwise>
				    		<th><a href="?page=${page}&amp;sort=servicename&amp;order=asc">${l_('Service')}</a></th>
						</py:otherwise>
					</py:choose>
					
					
				    <py:choose test="">
						<py:when test="sort=='entrytime' and order=='asc'">
				    		<th class="asc"><a href="?page=${page}&amp;sort=entrytime&amp;order=desc">
				    			<img src="${tg.url('/images/down.gif')}" alt="descending" /> ${l_('Entry time')}
				    		</a></th>
					  	</py:when>
						<py:when test="sort=='entrytime' and order=='desc'">
				    		<th class="desc"><a href="?page=${page}&amp;sort=entrytime&amp;order=asc">
				    			<img src="${tg.url('/images/up.gif')}" alt="ascending" /> ${l_('Entry time')}
				    		</a></th>
					  	</py:when>
						<py:otherwise>
				    		<th><a href="?page=${page}&amp;sort=entrytime&amp;order=asc">${l_('Entry time')}</a></th>
						</py:otherwise>
					</py:choose>
					
					
				    <py:choose test="">
						<py:when test="sort=='author' and order=='asc'">
				    		<th class="asc"><a href="?page=${page}&amp;sort=author&amp;order=desc">
				    			<img src="${tg.url('/images/down.gif')}" alt="descending" /> ${l_('Author')}
				    		</a></th>
					  	</py:when>
						<py:when test="sort=='author' and order=='desc'">
				    		<th class="desc"><a href="?page=${page}&amp;sort=author&amp;order=asc">
				    			<img src="${tg.url('/images/up.gif')}" alt="ascending" /> ${l_('Author')}
				    		</a></th>
					  	</py:when>
						<py:otherwise>
				    		<th><a href="?page=${page}&amp;sort=author&amp;order=asc">${l_('Author')}</a></th>
						</py:otherwise>
					</py:choose>
					
					
				    <py:choose test="">
						<py:when test="sort=='comment' and order=='asc'">
				    		<th class="asc"><a href="?page=${page}&amp;sort=comment&amp;order=desc">
				    			<img src="${tg.url('/images/down.gif')}" alt="descending" /> ${l_('Comment')}
				    		</a></th>
					  	</py:when>
						<py:when test="sort=='comment' and order=='desc'">
				    		<th class="desc"><a href="?page=${page}&amp;sort=comment&amp;order=asc">
				    			<img src="${tg.url('/images/up.gif')}" alt="ascending" /> ${l_('Comment')}
				    		</a></th>
					  	</py:when>
						<py:otherwise>
				    		<th><a href="?page=${page}&amp;sort=comment&amp;order=asc">${l_('Comment')}</a></th>
						</py:otherwise>
					</py:choose>
					
					
				    <py:choose test="">
						<py:when test="sort=='start' and order=='asc'">
				    		<th class="asc"><a href="?page=${page}&amp;sort=start&amp;order=desc">
				    			<img src="${tg.url('/images/down.gif')}" alt="descending" /> ${l_('Start')}
				    		</a></th>
					  	</py:when>
						<py:when test="sort=='start' and order=='desc'">
				    		<th class="desc"><a href="?page=${page}&amp;sort=start&amp;order=asc">
				    			<img src="${tg.url('/images/up.gif')}" alt="ascending" /> ${l_('Start')}
				    		</a></th>
					  	</py:when>
						<py:otherwise>
				    		<th><a href="?page=${page}&amp;sort=start&amp;order=asc">${l_('Start')}</a></th>
						</py:otherwise>
					</py:choose>
					
					
				    <py:choose test="">
						<py:when test="sort=='end' and order=='asc'">
				    		<th class="asc"><a href="?page=${page}&amp;sort=end&amp;order=desc">
				    			<img src="${tg.url('/images/down.gif')}" alt="descending" /> ${l_('End')}
				    		</a></th>
					  	</py:when>
						<py:when test="sort=='end' and order=='desc'">
				    		<th class="desc"><a href="?page=${page}&amp;sort=end&amp;order=asc">
				    			<img src="${tg.url('/images/up.gif')}" alt="ascending" /> ${l_('End')}
				    		</a></th>
					  	</py:when>
						<py:otherwise>
				    		<th><a href="?page=${page}&amp;sort=end&amp;order=asc">${l_('End')}</a></th>
						</py:otherwise>
					</py:choose>
					
					
				    <py:choose test="">
						<py:when test="sort=='status' and order=='asc'">
				    		<th class="asc"><a href="?page=${page}&amp;sort=status&amp;order=desc">
				    			<img src="${tg.url('/images/down.gif')}" alt="descending" /> ${l_('Status')}
				    		</a></th>
					  	</py:when>
						<py:when test="sort=='status' and order=='desc'">
				    		<th class="desc"><a href="?page=${page}&amp;sort=status&amp;order=asc">
				    			<img src="${tg.url('/images/up.gif')}" alt="ascending" /> ${l_('Status')}
				    		</a></th>
					  	</py:when>
						<py:otherwise>
				    		<th><a href="?page=${page}&amp;sort=status&amp;order=asc">${l_('Status')}</a></th>
						</py:otherwise>
					</py:choose>
				</tr> 
			</thead> 
			<tbody>
				<tr py:for="raw_id, raw in enumerate(downtimes)" class="${raw_id%2 and 'even' or 'odd'}">
					<td class="action_col">
						<a href="${tg.url('/downtime/edit_downtime', {'id': raw.iddowntime})}"><img src="${tg.url('/images/edit.png')}" alt="edit" /></a>
						<a href="${tg.url('/downtime/delete_downtime', {'id': raw.iddowntime})}"><img src="${tg.url('/images/delete.png')}" alt="delete" /></a>
					</td>
					<td>${raw.hostname}</td>
					<td>${raw.servicename}</td>
				    <td>${raw.entrytime}</td>
				    <td>${raw.author}</td>
				    <py:choose test="">
						<py:when test="len(raw.comment) > 23">
							<td>
								${raw.comment[:23]}<a id="comment_${raw_id}" href="#comment_${raw_id}" title="${raw.comment}">...</a>
							</td>
					  	</py:when>
						<py:otherwise>
					  		<td>${raw.comment}</td>
						</py:otherwise>
					</py:choose>
				    <td>${raw.start}</td>
				    <td>${raw.end}</td>
				    <td>${raw.status}</td>
				</tr> 
			</tbody>
		</table>
	</div>

	<p class="pagelist">
		<a class="prev_page" href="?page=${current_page.previous_page}${url_param}"><img src="${tg.url('/images/arrow-left.png')}" alt="edit" /></a>
			${current_page.pager(format='~3~', page_param='page', show_if_single_page=True, sort=sort, order=order)}
		<a class="next_page" href="?page=${current_page.next_page}${url_param}"><img src="${tg.url('/images/arrow-right.png')}" alt="edit" /></a>
	</p>

	<script type="text/javascript">
		window.addEvent('domready', function (){
		    window.host_cmpl = new Autocompleter.Request.VigiloJSON(
		        'host',
		        '${tg.url("/autocomplete/host")}',
		        {
		            minLength: 3,
		            selectMode: 'type-ahead',
		            forceSelect: true,
		            postVar: 'host',
		        }
		    );
		    window.host_cmpl.addEvent('selection', function (el, sel, val, input) {
		        window.service_cmpl.options.postData['host'] = val;
		        $$('service').set('value', '');
		    });

		    window.service_cmpl = new Autocompleter.Request.VigiloJSON(
		        'service',
		        '${tg.url("/autocomplete/service")}',
		        {
		            minLength: 3,
		            selectMode: 'type-ahead',
		            forceSelect: true,
		            postData: {},
		            postVar: 'service',
		        }
		    );
		    var val = $$('host').get('value');
		    if (val != '')
		        window.service_cmpl.options.postData['host'] = val;
		});
	</script>
	
</body>
</html>

