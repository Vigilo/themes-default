<html xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip="">

<th id="plugin_${name}" class="plugin_${name}" py:def="date_header(name, instance)">
    Date<br />
    [Duration]
</th>

<py:def function="date_data(name, instance, data, plugin_data)">
    <?python from babel import Locale ?>
    <?python from babel.dates import format_datetime ?>
    <?python from tg.i18n import get_lang ?>
    <?python from vigilo.turbogears.helpers import get_locales ?>
    <!--! Note: get_lang() renvoie None durant les tests unitaires. -->
    <td class="plugin_${name} ${data['state']}"
        py:with="locale = Locale.negotiate(get_lang() or ['en'], get_locales('vigiboard'), sep='-'); hours, minutes = divmod(data['duration'].seconds / 60, 60)">
    ${format_datetime(data['date'], format='medium', locale=locale)}<br/>
    [${"%dd %dh %d'" % (data['duration'].days , hours , minutes)}]
    </td>
</py:def>

<py:def function="plugin_template(name, instance)">
    <?python
        plugin_header_functions[name] = date_header
        plugin_data_functions[name] = date_data
    ?>
</py:def>

</html>
