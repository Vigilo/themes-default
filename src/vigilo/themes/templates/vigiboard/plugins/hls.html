<html xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip="">

<py:def function="plugin_template(name, instance)">
<script type="text/javascript">
/*<![CDATA[*/
    window.addEvent('domready', function () {
        window.hls_dialog = new Jx.Dialog({
            id: "hls_dialog",
            label: "${l_('Impacted high-level services').encode('backslash')}",
            modal: false,
            resize: false,
            move: true,
            content: '',
            width: 275,
            height: 183,
            onOpen: window.dlg_open_handler,
            onClose: window.dlg_close_handler
        });
    });

    function vigiboard_hls_dialog(ref, url, idd) {
        window.hls_dialog.setBusy(true);
        window.hls_dialog.open();

        var req = new Request.JSON({
            url: '${tg.url("/get_plugin_value")}',
            onSuccess: function (json, raw) {
                var code = '<ul id="plugin_hls_list">';
                for (var i = 0; i < json.services.length; i++)
                    code += '<li>' + json.services[i] + '<\/li>';
                code += '<\/ul>';
                window.hls_dialog.setBusy(false);
                window.hls_dialog.setContent(code);
            },
            onFailure: function (xhr) {
                window.hls_dialog.setBusy(false);
                window.hls_dialog.setContent("${l_('Error while retrieving data').encode('backslash')}");
            }
        });
        req.post({plugin_name: 'hls', idcorrevent: idd});
    }
/*]]>*/
</script>
</py:def>

<th id="plugin_${name}" class="plugin_${name}" py:def="header_template(name, instance)"
    title="Impacted High-Level Services">Impacted HLS</th>

<td class="plugin_${name}" py:def="data_template(name, instance, data)">
    <py:with vars="hls = instance.get_value(data[0].idcorrevent)['services']">
    <py:choose test="len(hls)">
        <py:when test="0"/>
        <py:when test="1">${hls[0]}</py:when>
        <py:otherwise>
        <a href="javascript:vigiboard_hls_dialog(this,'${tg.url('/')}',${data[0].idcorrevent})">${len(hls)}</a>
        </py:otherwise>
    </py:choose>
    </py:with>
</td>

</html>
